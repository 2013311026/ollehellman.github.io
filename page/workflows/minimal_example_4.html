<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
	 <meta name="description" content="Temperature dependent effective potential 1.0">
    
    <meta name="author" content="Olle Hellman" >
    <meta name="sourcefile" content="">
    <link rel="icon" href="../../favicon.png">

    <title>Minimal example IV &ndash; TDEP</title>

<!-- <link href="../../css/bootstrap.min.css" rel="stylesheet"> -->
    <link href="../../css/bootstrap.css" rel="stylesheet"> 
    <link href="../../css/ollesfixes.css" rel="stylesheet"> 
    <link href="../../css/pygments.css" rel="stylesheet">
    <link href="../../css/font-awesome.min.css" rel="stylesheet">
    <link href="../../css/local.css" rel="stylesheet"> 
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../../js/jquery-2.1.3.min.js"></script>
    <script src="../../js/svg-pan-zoom.min.js"></script>

    
    <script src="../../tipuesearch/tipuesearch_content.js"></script>
    <link  href="../../tipuesearch/tipuesearch.css" rel="stylesheet">
    <script src="../../tipuesearch/tipuesearch_set.js"></script>
    <script src="../../tipuesearch/tipuesearch.js"></script>
    
  </head>

<body>
<div class="wrapper"><!-- my wrapper to make the footer stick at the bottom -->

<!-- Fixed navbar, defined in macros.html for some reason -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../../index.html">TDEP <small>1.0</small></a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav">
            <!-- manual thingy -->
            
            <li><a href='../../page/index.html'>Manual</a></li>
            
            <!-- programs -->
            
            <li><a href="../../lists/programs.html">Programs</a></li>
            
            <!-- API -->
            <li>
            <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="apidropdown">API<span class="caret"></span></a>
            <ul class="dropdown-menu" aria-labelledby="apidropdown">
                
                <li><a href="../../lists/files.html">Source Files</a></li>
                
                
                
                
                
            </ul>
            </li>
        </ul>
        
        <form action="../../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
            <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
        </form>
        
        </div>
    </div>
</nav>

<div class="container-fluid">
    
</div>
<div class="jumbotron">
<div class="container-fluid">
  <h3>Minimal example IV</h3>
</div>
</div>
<div class="container-fluid">

<div class="row">
    
        <div class="col-sm-3">
        <div class="toc">
            <ul class="nav nav-stacked nav-pills">
            <li role="presentation" class="title"><a href='../../page/index.html'>Manual</a></li>
            </ul>
            <ul class="nav nav-stacked nav-pills">
            
                <li role="presentation">
                <a href='../../page/./0_installation.html'>Installation</a>
                
                </li>
            
                <li role="presentation">
                <a href='../../page/./1_utilities.html'>Utility scripts</a>
                
                </li>
            
                <li role="presentation">
                <a href='../../page/./files.html'>Files</a>
                
                </li>
            
                <li role="presentation">
                <a href='../../page/workflows/index.html'>Workflows</a>
                
                    <ul class="nav nav-stacked nav-pills">
                      
                <li role="presentation">
                <a href='../../page/workflows/minimal_example_1.html'>Minimal example I</a>
                
                </li>
            
                <li role="presentation">
                <a href='../../page/workflows/minimal_example_2.html'>Minimal example II</a>
                
                </li>
            
                <li role="presentation">
                <a href='../../page/workflows/minimal_example_3.html'>Minimal example III</a>
                
                </li>
            
                <li role="presentation" class="disabled">
                <a href='../../page/workflows/minimal_example_4.html'>Minimal example IV</a>
                
                </li>
            
                <li role="presentation">
                <a href='../../page/workflows/minimal_example_5.html'>Minimal example V</a>
                
                </li>
            
                <li role="presentation">
                <a href='../../page/workflows/minimal_example_6.html'>Minimal example VI</a>
                
                </li>
            
                <li role="presentation">
                <a href='../../page/workflows/using_the_library.html'>Using the library</a>
                
                </li>
            
                    </ul>
                
                </li>
            
            </ul>
        </div>
        </div>
    
    <div class="col-sm-offset-1 col-sm-6 col-sm-offset-2" id='text'>
        <h3>Basic free energy calculations</h3>
<p>Navigate to <code>/example_4_free_energy</code>. There you should see 5 folders, each corresponding to a simulation at fix temperature, but different volumes. This particular case is PbTe at 600K. Copy all the contents to a new folder.</p>
<p>First, we will get the free energy at a single volume. Pick one of the folders, perhaps <code>volume_1</code>. We will constrain ourselves to second order force constants, run:</p>
<div class="codehilite"><pre><span></span>extract_forceconstants -rc2 100 -U0
ln -s outfile.forceconstant infile.forceconstant
phonon_dispersion_relations -loto --dos -qg 36 36 36 --temperature 300
</pre></div>


<p>This will produce plenty of output. The first lines calculates the second order forceconstants, including the option of calculating the renormalized baseline energy. You should have read about <a href="../../program/extract_forceconstants.html">forceconstants</a> already, and perhaps this is a good time to familiarize yourself with free energy calculations a bit. I put a decent explanation of the different terms <a href="../../program/phonon_dispersion_relations.html#sec_tdepthermo">here</a>. Glance through the documentation and see what the different command line options do.</p>
<p></p><div class="alert alert-success" role="alert"><h4>Todo</h4><p>I realise now that maybe it would be logical to have an option called <code>--free_energy</code> or equivalent. Maybe add that, or rename an existing one.</p></div>
<p>The things you need for the free energy is the renormalized baseline, $U_0$, and the phonon free energy $F_{\textrm{ph}}$. These will be in <a href="../../program/extract_forceconstants.html#outfile.U0">outfile.U0</a> and <a href="../../program/phonon_dispersion_relations.html#outfile.free_energy">outfile.free_energy</a> respectively. If everything worked out ok, you should have something like</p>
<div class="codehilite"><pre><span></span>Fph = -0.26006391 eV/atom 
U0  = -3.76922936 eV/atom
</pre></div>


<p>So, by adding these numbers you get the Helmholtz free energy. Electronic entropy will be included, provided that it is in $U_0$. It is up to you to ensure that the underlying DFT calculations include that properly.</p>
<p>You can't get that much useful information from a single point in volume-temperature space, lets get the free energy for all the volumes, conveniently done with a small script:</p>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># Get the forceconstants and free energy for every volume</span>
<span class="k">for</span> i in <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> 5
<span class="k">do</span>
    <span class="nb">cd</span> volume_<span class="si">${</span><span class="nv">i</span><span class="si">}</span>
        extract_forceconstants -rc2 <span class="m">100</span> -U0
        ln -sf outfile.forceconstant infile.forceconstant
        phonon_dispersion_relations --dos --temperature <span class="m">600</span> -qg <span class="m">32</span> <span class="m">32</span> <span class="m">32</span> --loto
    <span class="nb">cd</span> ..
<span class="k">done</span>
</pre></div>


<p>This should result in a list of volumes and energies (it does not appear magically, you have to fetch the numbers):</p>
<div class="codehilite"><pre><span></span> Volume        U0           Fph
 29.92236913  -3.76922936  -0.26006391 
 31.84747692  -3.82606181  -0.27327257 
 33.85343312  -3.84306260  -0.28655016 
 35.94026710  -3.82961324  -0.30108423 
 38.11284394  -3.80467151  -0.30650145 
</pre></div>


<p>Plotting this, and fitting to an equation of state (Birch-Murnaghan) should like like this:</p>
<p><center>
<img src="../../media/pbte_free_energy.png" width="500" />
</center></p>
<p>Make sure you can reproduce this.</p>
<h4>Small improvement</h4>
<p>First thing we can improve is how the forceconstants are extracted. In the script above, we do a full symmetry analysis for each of the volumes. That is fine, but unnecessary. The symmetry of each supercell is the same. If we modify the script slightly</p>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># Got to the first volume and do the symmetry analysis</span>
<span class="nb">cd</span> volume_1
    extract_forceconstants -rc2 100
    mv outfile.forcemap.hdf5 ../
<span class="nb">cd</span> ..

<span class="c1"># Reuse the symmetry analysis and get the free energy</span>
<span class="k">for</span> i in <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> 5
<span class="k">do</span>
    <span class="nb">cd</span> volume_<span class="si">${</span><span class="nv">i</span><span class="si">}</span>
        ln -sf ../outfile.forcemap.hdf5 infile.forcemap.hdf5
        extract_forceconstants -rc2 <span class="m">100</span> -U0 --readforcemap
        ln -sf outfile.forceconstant infile.forceconstant
        phonon_dispersion_relations --dos --temperature <span class="m">600</span> -qg <span class="m">32</span> <span class="m">32</span> <span class="m">32</span> --loto
    <span class="nb">cd</span> ..
<span class="k">done</span>
</pre></div>


<p>If you try it out, you will find that it runs a little faster. Nothing significant in this small case, but for production quality calculations this is useful. Using the same <code>infile.forcemap.hdf5</code> is also a good idea, which will become apparent later.</p>
<h4>Exercises to try:</h4>
<ul>
<li>Rerun things with different q-point grids for the the phonon free energy. What does the convergence look like?</li>
<li>Use subsets of the simulation to calculate $U_0$ (using <code>--stride</code>, explained <a href="../../program/extract_forceconstants.html">here</a>), what does that convergence look like?</li>
</ul>
    </div>
</div>


    <br>
    <br>
</div> <!-- /container -->

</div><!-- end of wrapper -->

<div class="footer">
<div class="container"> 
        <br>
        <div class="row">
            <div class="col-md-4">&copy; 2016 </div>
            <div class="col-md-4"><span class="text-center"> TDEP was developed by Olle Hellman</span></div>
            <div class="col-md-4"><span class="pull-right">Documentation generated by <a href="https://github.com/cmacmackin/ford">FORD</a></span></div>
        </div>
        <br>
        <br>
</div>
</div>

    <!-- Bootstrap core JavaScript -->
    <script src="../../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../js/ie10-viewport-bug-workaround.js"></script>
    <!-- MathJax JavaScript -->
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],
            TeX: { 
                extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], 
                equationNumbers: { autoNumber: 'AMS' } 
            },
            jax: ['input/TeX','input/MathML','output/HTML-CSS'],
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                processEscapes: true
            },
            'HTML-CSS': { 
                styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: '#000000 ! important'} }
            }
        });
    </script>
    <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>