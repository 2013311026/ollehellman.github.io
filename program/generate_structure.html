<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
	 <meta name="description" content="Temperature dependent effective potential 1.1">
    
    <meta name="author" content="Olle Hellman" >
    <link rel="icon" href="../favicon.png">

    <title>
    
        generate structure &ndash; TDEP
    
</title>

<!-- <link href="../css/bootstrap.min.css" rel="stylesheet"> -->
    <link href="../css/bootstrap.css" rel="stylesheet"> 
    <link href="../css/ollesfixes.css" rel="stylesheet"> 
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet"> 
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
  </head>

<body>
<div class="wrapper"><!-- my wrapper to make the footer stick at the bottom -->

<!-- Fixed navbar, defined in macros.html for some reason -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
<div class="navbar-brand"><img style="height:50px; position: relative; left: 0px; top: -10px" src="../media/matematico.png"></div>
            <a class="navbar-brand" href="../index.html">TDEP <small>1.1</small></a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav">
            <!-- manual thingy -->
            
            <li><a href='../page/index.html'>Manual</a></li>
            
            <!-- programs -->
            <li>
            <a class="dropdown-toggle" data-toggle="dropdown" href="programs.html" id="programdropdown">Programs<span class="caret"></span></a>
            <ul class="dropdown-menu" aria-labelledby="apidropdown">
                
                    <li>
                        
                            <a href="../program/atomic_distribution.html">atomic distribution</a>
                        
                     </li>
                
                    <li>
                        
                            <a href="../program/canonical_configuration.html">canonical configuration</a>
                        
                     </li>
                
                    <li>
                        
                            <a href="../program/crystal_structure_info.html">crystal structure info</a>
                        
                     </li>
                
                    <li>
                        
                            <a href="../program/extract_forceconstants.html">extract forceconstants</a>
                        
                     </li>
                
                    <li>
                        
                            <a href="../program/generate_structure.html">generate structure</a>
                        
                     </li>
                
                    <li>
                        
                            <a href='../program/lineshape.html'>lineshape</a>
                        
                     </li>
                
                    <li>
                        
                            <a href="../program/phonon_dispersion_relations.html">phonon dispersion relations</a>
                        
                     </li>
                
                    <li>
                        
                            <a href="../program/samples_from_md.html">samples from md</a>
                        
                     </li>
                
                    <li>
                        
                            <a href="../program/thermal_conductivity.html">thermal conductivity</a>
                        
                     </li>
                
            </ul>
            </li>
            <!-- API -->
            <li>
            <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="apidropdown">API<span class="caret"></span></a>
            <ul class="dropdown-menu" aria-labelledby="apidropdown">
                
                <li><a href="../lists/files.html">Source Files</a></li>
                
                
                <li><a href="../lists/modules.html">Modules</a></li>
                
                
                <li><a href="../lists/procedures.html">Procedures</a></li>
                
                
                
                <li><a href="../lists/types.html">Derived Types</a></li>
                
            </ul>
            </li>
        </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
            <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
        </form>
        
        </div>
    </div>
</nav>

<div class="container-fluid">
    


</div>

<div class="jumbotron">
<div class="container-fluid">
    
        <h3>generate structure</h3>
    
</div>
</div>

<div class="container-fluid">
  <div class="row">
    <div class="col-sm-offset-2 col-sm-7 col-sm-offset-3" id='text'>
    <h3>Short description</h3>
<p>Builds supercells, diagonal and non-diagonal. Also has the capability to find the optimal supercells for a given lattice, very handy when you have complicated structures.</p>
<h3>Command line options:</h3>
<p>Optional switches:</p>
<ul>
<li>
<p><code>--dimensions value#1 value#2 value#3</code>, <code>-d value#1 value#2 value#3</code><br>
    default value 5 5 5<br>
    Dimensions of supercell.</p>
</li>
<li>
<p><code>--nondiagonal_dimensions value#1 value#2 value#3 value#4 value#5 value#6 value#7 value#8 value#9</code>, <code>-nd value#1 value#2 value#3 value#4 value#5 value#6 value#7 value#8 value#9</code><br>
    default value 0 0 0 0 0 0 0 0 0<br>
    Non-diagonal dimensions of supercell.</p>
</li>
<li>
<p><code>--output_format value</code>, <code>-of value</code>, value in: <code>1,2,3,4,5</code><br>
    default value 1<br>
    Output format. 1 is VASP, 2 Abinit, 3 LAMMPS, 4 xyz-files for i-pi, 5 FHI-Aims</p>
</li>
<li>
<p><code>--magnetic_bins value</code>, <code>-mb value</code><br>
    default value 5<br>
    Number of bins in correlation functions, from order to disorder.</p>
</li>
<li>
<p><code>--magnetic_configurations value</code>, <code>-mc value</code><br>
    default value 10<br>
    Number of magnetic configurations per bin</p>
</li>
<li>
<p><code>--desired_na value</code>, <code>-na value</code><br>
    default value -1<br>
    Desired number of atoms in supercell. Will try to choose a cell as cubic as possible.</p>
</li>
<li>
<p><code>--help</code>, <code>-h</code><br>
    Print this help message</p>
</li>
<li>
<p><code>--version</code>, <code>-v</code><br>
    Print version</p>
</li>
</ul>
<h3>Examples</h3>
<p><code>generate_structure -dim 4 3 5</code> </p>
<h3>Longer summary</h3>
<p>This code builds a supercell with user-specified dimensions from the unit cell given in <code>infile.ucposcar</code>. All positions are in fractional coordinates.</p>
<p>The code handles diagonal and non-diagonal cells. The diagonal cells are simple repetitions of the unit cell, making it $N_1 \times N_2 \times N_3$ larger. The non-diagonal cells can be useful when the unit cell has an awkward shape. The supercell will have the lattice vectors</p>
<p>$$
\begin{pmatrix}
\mathbf{A}_1 \\
\mathbf{A}_2 \\
\mathbf{A}_3 \\
\end{pmatrix}
= \mathbf{M}
\begin{pmatrix}
\mathbf{a}_1 \\
\mathbf{a}_2 \\
\mathbf{a}_3
\end{pmatrix}
$$</p>
<p>where $\det( \mathbf{M} )$ is a positive integer. Some useful transformations are, for example, with <code>-nd -n1 n1 n1 n2 -n2 n2 n3 n3 -n3</code>, from a primitive fcc lattice to the conventional cubic</p>
<p>$$
\begin{pmatrix}
n_1 a &amp; 0 &amp; 0 \\
0 &amp; n_2 a &amp; 0 \\
0 &amp; 0 &amp; n_3 a
\end{pmatrix}
=\begin{pmatrix}
-n_1 &amp; n_1 &amp; n_1 \\
n_2 &amp; -n_2 &amp; n_2 \\
n_3 &amp; n_3 &amp; -n_3
\end{pmatrix}
\begin{pmatrix}
0 &amp; a/2 &amp; a/2 \\
a/2 &amp; 0 &amp; a/2 \\
a/2 &amp; a/2 &amp; 0
\end{pmatrix}
$$</p>
<p>Similarly, from a primitive bcc to conventional cubic:</p>
<p>$$
\begin{pmatrix}
n_1 a &amp; 0 &amp; 0 \\
0 &amp; n_2 a &amp; 0 \\
0 &amp; 0 &amp; n_3 a
\end{pmatrix}
=\begin{pmatrix}
0 &amp; n_1 &amp; n_1 \\
n_2 &amp; 0 &amp; n_2 \\
n_3 &amp; n_3 &amp; 0
\end{pmatrix}
\begin{pmatrix}
-a/2 &amp; a/2 &amp; a/2 \\
a/2 &amp; -a/2 &amp; a/2 \\
a/2 &amp; a/2 &amp; -a/2
\end{pmatrix}
$$</p>
<p>There are some non-obvious ones as well, such as converting a hexagonal lattice to an orthorhombic:</p>
<p>$$
\begin{pmatrix}
n_1 a &amp; 0 &amp; 0 \\
0 &amp; \sqrt{3} n_2 a  &amp; 0 \\
0 &amp; 0 &amp; n_3 c
\end{pmatrix}
=\begin{pmatrix}
n_1 &amp; n_1 &amp; 0 \\
-n_2 &amp; n_2 &amp; 0 \\
0 &amp; 0 &amp; n_3
\end{pmatrix}
\begin{pmatrix}
a/2 &amp; -a\sqrt{3}/2 &amp; 0 \\
a/2 &amp; a \sqrt{3}/2 &amp; 0 \\
0 &amp; 0 &amp; c
\end{pmatrix}
$$</p>
<p>or rhombohedral (lattice parameter $a$, angle $\alpha$) to hexagonal:</p>
<p>$$
\begin{equation*}
\begin{split}
\begin{pmatrix}
0 &amp; n_1 a \sqrt{2-2 \cos\alpha} &amp; 0  \\
-n_2 a\sqrt{ \frac{2-2 \cos\alpha}{3} } &amp; -n_2 a \sqrt{2-2 \cos\alpha}  &amp; 0 \\
0 &amp; 0 &amp; n_3 a \sqrt{3+6\cos\alpha}
\end{pmatrix}
= \\ \\ \begin{pmatrix}
n_1 &amp; n_1 &amp; 0 \\
-n_2 &amp; n_2 &amp; 0 \\
0 &amp; 0 &amp; n_3
\end{pmatrix}
\begin{pmatrix}
a\sqrt{2-2\cos\alpha} &amp; 0 &amp; a\sqrt{\frac{1+2\cos\alpha}{3}} \\
-a\sqrt{\frac{1-\cos\alpha}{2}} &amp; a\sqrt{3\frac{1-\cos\alpha}{2}} &amp; a\sqrt{\frac{1+2\cos\alpha}{3}} \\
-a\sqrt{\frac{1-\cos\alpha}{2}} &amp; -a\sqrt{3\frac{1-\cos\alpha}{2}} &amp; a\sqrt{\frac{1+2\cos\alpha}{3}}
\end{pmatrix}
\end{split}
\end{equation*}
$$</p>
<p>There are too many ways to build supercells to list here. The examples are suggestions so that you can pick a supercell that is as cubic as possible. Converging results with respect to supercell size goes approximately as the size of the largest sphere you can fit in the cell.</p>
<h4>Automatic generation</h4>
<p>The option <code>-na</code> will try to determine a non-diagonal supercell that is as cubic as possible, with the number of atoms close to the specified value. It does it by generating a massive amount of possible supercell transformation matrices, and comparing the ratio of the cell volume and the volume of the inscribed sphere. By optimizing with respect to this ratio, a reasonably cubic cell should be the result. Very useful when you have a unitcell with a tricky shape and it's non-trivial to figure out a meaningful transformation matrix.</p>
<p>To clarify, a cell defined by vectors $\mathbf{a}$, $\mathbf{b}$ and $\mathbf{c}$ will have the volume</p>
<p>$$
V=\left|\det
\begin{pmatrix}
  a_x &amp; a_y &amp; a_z \\
  b_x &amp; b_y &amp; b_z \\
  c_x &amp; c_y &amp; c_z
\end{pmatrix}\right|
$$</p>
<p>In the same cell, the radius largest sphere that can be inscribed is given by</p>
<p>$$
2r=\min\left\{
\left|\frac{ \mathbf{b} \times \mathbf{c} }{\left| \mathbf{b} \times \mathbf{c} \right|}\cdot \mathbf{a}\right| \,,\quad
\left|\frac{ \mathbf{a} \times \mathbf{b} }{\left| \mathbf{a} \times \mathbf{b} \right|}\cdot \mathbf{c}\right| \,,\quad
\left|\frac{ \mathbf{a} \times \mathbf{c} }{\left| \mathbf{a} \times \mathbf{c} \right|}\cdot \mathbf{b}\right|
\right\}  
$$</p>
<p>I define the ratio</p>
<p>$$
f^3 = \frac{r^3 4 \pi}{3V} \le 1
$$</p>
<p>As the function to be maximized (it is the ratio of the filling ratio of a cell and the filling ratio of a cube with the same volume, a value of 1 indicates a perfect cube). The algorithm works by searching the space of non-diagonal supercell matrices that produce approximately the desired number of atoms and simultaneously maximize the filling ratio. This algorithm produces rather non-intuitive cells. Consider Bi<sub>2</sub>Te<sub>3</sub> defined in the primitive rhombohedral cell:</p>
<div class="codehilite"><pre><span></span>Bi2Te3
  10.314046162
 0.243360208934  0.000000000000  0.969935981757
-0.121680104467  0.210756123207  0.969935981757
-0.121680104467 -0.210756123207  0.969935981757
Bi Te
2 3
direct coordinates
 0.599898812406  0.599898812406  0.599898812406 site: 1
 0.400101187594  0.400101187594  0.400101187594 site: 2
 0.791308614612  0.791308614612  0.791308614612 site: 3
 0.208691385388  0.208691385388  0.208691385388 site: 4
 0.000000000000  0.000000000000  0.000000000000 site: 5
</pre></div>


<p>Using this algorithm I found the supercell matrix</p>
<p>$$
M=\begin{pmatrix}
3 &amp; 2 &amp; -4 \\
4 &amp; -3 &amp; -2 \\
-2 &amp; 4 &amp; -3
\end{pmatrix}
$$</p>
<p>that produce the lattice vectors</p>
<div class="codehilite"><pre><span></span>Bi2Te3 upercell
      10.314046161996
    0.97344083573636     1.26453673924247     0.96993598175736
    1.58184135807159    -0.21075612320708    -0.96993598175736
   -0.60840052233523     1.47529286244955    -0.96993598175736
 Bi Te
 86 129
</pre></div>


<p>This cell has a filling ratio corresponding to 98.4% of the ideal cube. I doubt I could have guessed how to generate this supercell.</p>
<h3>Input files</h3>
<ul>
<li><a href="../page/files.html#infile.ucposcar">infile.ucposcar</a></li>
</ul>
<h3>Output files</h3>
<ul>
<li><a href="../page/files.html#infile.ssposcar">outfile.ssposcar</a></li>
</ul>
    </div>
  </div>

    <br>
    <br>
</div> <!-- /container -->

</div><!-- end of wrapper -->

<div class="footer">
<div class="container"> 
        <br>
        <div class="row">
            <div class="col-md-4">&copy; 2018 </div>
            <div class="col-md-4"><span class="text-center"> TDEP was developed by Olle Hellman & Nina Shulumba</span></div>
            <div class="col-md-4"><span class="pull-right">Documentation generated by <a href="https://github.com/cmacmackin/ford">FORD</a></span></div>
        </div>
        <br>
        <br>
</div>
</div>

    <!-- Bootstrap core JavaScript -->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>
    <!-- MathJax JavaScript -->
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],
            TeX: { 
                extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], 
                equationNumbers: { autoNumber: 'AMS' } 
            },
            jax: ['input/TeX','input/MathML','output/HTML-CSS'],
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                processEscapes: true
            },
            'HTML-CSS': { 
                styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: '#000000 ! important'} }
            }
        });
    </script>
    <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>