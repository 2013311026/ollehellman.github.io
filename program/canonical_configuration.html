<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
	 <meta name="description" content="Temperature dependent effective potential 1.0">
    
    <meta name="author" content="Olle Hellman" >
    <link rel="icon" href="../favicon.png">

    <title>
    
        canonical configuration &ndash; TDEP
    
</title>

<!-- <link href="../css/bootstrap.min.css" rel="stylesheet"> -->
    <link href="../css/bootstrap.css" rel="stylesheet"> 
    <link href="../css/ollesfixes.css" rel="stylesheet"> 
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet"> 
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
  </head>

<body>
<div class="wrapper"><!-- my wrapper to make the footer stick at the bottom -->

<!-- Fixed navbar, defined in macros.html for some reason -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../index.html">TDEP <small>1.0</small></a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav">
            <!-- manual thingy -->
            
            <li><a href='../page/index.html'>Manual</a></li>
            
            <!-- programs -->
            <li>
            <a class="dropdown-toggle" data-toggle="dropdown" href="programs.html" id="programdropdown">Programs<span class="caret"></span></a>
            <ul class="dropdown-menu" aria-labelledby="apidropdown">
                
                    <li>
                        
                            <a href="../program/atomic_distribution.html">atomic distribution</a>
                        
                     </li>
                
                    <li>
                        
                            <a href='../program/autocorrelation.html'>autocorrelation</a>
                        
                     </li>
                
                    <li>
                        
                            <a href="../program/canonical_configuration.html">canonical configuration</a>
                        
                     </li>
                
                    <li>
                        
                            <a href="../program/crystal_structure_info.html">crystal structure info</a>
                        
                     </li>
                
                    <li>
                        
                            <a href="../program/extract_forceconstants.html">extract forceconstants</a>
                        
                     </li>
                
                    <li>
                        
                            <a href="../program/generate_structure.html">generate structure</a>
                        
                     </li>
                
                    <li>
                        
                            <a href='../program/lineshape.html'>lineshape</a>
                        
                     </li>
                
                    <li>
                        
                            <a href="../program/phonon_dispersion_relations.html">phonon dispersion relations</a>
                        
                     </li>
                
                    <li>
                        
                            <a href="../program/remap_forceconstant.html">remap forceconstant</a>
                        
                     </li>
                
                    <li>
                        
                            <a href="../program/samples_from_md.html">samples from md</a>
                        
                     </li>
                
                    <li>
                        
                            <a href="../program/thermal_conductivity.html">thermal conductivity</a>
                        
                     </li>
                
            </ul>
            </li>
            <!-- API -->
            <li>
            <a class="dropdown-toggle" data-toggle="dropdown" href="#" id="apidropdown">API<span class="caret"></span></a>
            <ul class="dropdown-menu" aria-labelledby="apidropdown">
                
                <li><a href="../lists/files.html">Source Files</a></li>
                
                
                
                
                
            </ul>
            </li>
        </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
            <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
        </form>
        
        </div>
    </div>
</nav>

<div class="container-fluid">
    


</div>

<div class="jumbotron">
<div class="container-fluid">
    
        <h3>canonical configuration</h3>
    
</div>
</div>

<div class="container-fluid">
  <div class="row">
    <!--
    <div class="col-sm-2">
    
<div id="sidebar">
  





















  <hr>
  

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allprogs-0">All Programs</a></h3></div>
  <div id="allprogs-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../program/atomic_distribution.html">atomic_distribution</a>
      
      <a class="list-group-item" href="../program/autocorrelation.html">autocorrelation</a>
      
      <a class="list-group-item" href="../program/canonical_configuration.html">canonical_configuration</a>
      
      <a class="list-group-item" href="../program/crystal_structure_info.html">crystal_structure_info</a>
      
      <a class="list-group-item" href="../program/extract_forceconstants.html">extract_forceconstants</a>
      
      <a class="list-group-item" href="../program/generate_structure.html">generate_structure</a>
      
      <a class="list-group-item" href="../program/lineshape.html">lineshape</a>
      
      <a class="list-group-item" href="../program/phonon_dispersion_relations.html">phonon_dispersion_relations</a>
      
      <a class="list-group-item" href="../program/remap_forceconstant.html">remap_forceconstant</a>
      
      <a class="list-group-item" href="../program/samples_from_md.html">samples_from_md</a>
      
      <a class="list-group-item" href="../program/thermal_conductivity.html">thermal_conductivity</a>
      
    </div>
  </div>
</div>


</div>  

    </div>
    -->
    
    <div class="col-sm-offset-2 col-sm-7 col-sm-offset-3" id='text'>
    <h3>Short description</h3>
<p>Use forceconstants or a Debye temperature to generate uncorrelated supercell configurations emulating a canonical ensemble. These configurations can be used to either start ensemble runs of molecular dynamics with negligible equilibration time, or be used to directly sample phase space.</p>
<h3>Command line options:</h3>
<p>Optional switches:</p>
<ul>
<li>
<p><code>--temperature value</code>, <code>-t value</code><br>
    default value 300<br>
    Temperature to emulate</p>
</li>
<li>
<p><code>--nconf value</code>, <code>-n value</code><br>
    default value 5<br>
    Number of configurations to generate</p>
</li>
<li>
<p><code>--quantum</code><br>
    default value .false.<br>
    Use Bose-Einstein statistics instead of Maxwell-Boltzmann. That is, use $$ \sqrt{\frac{\hbar (2n+1) }{2 m \omega}} $$ as the mean normal mode amplitudes instead of the classical $$ \frac{1}{\omega}\sqrt{\frac{k_BT}{m}} $$</p>
</li>
<li>
<p><code>--output_format value</code>, <code>-of value</code>, value in: <code>1,2</code><br>
    default value 1<br>
    Selects output format. 1 is VASP, 2 is Abinit. Default 1.</p>
</li>
<li>
<p><code>--threshold value</code><br>
    default value -1<br>
    Minimum frequency to consider. Frequencies smaller than this number will be replaced by this number when evaluating displacements. Useful for materials with extremely low-lying modes that can cause divergencies.</p>
</li>
<li>
<p><code>--debye_temperature value</code>, <code>-td value</code><br>
    default value -1<br>
    Generate forceconstants that match a Debye temperature, and build displacements according to these. See details below.</p>
</li>
<li>
<p><code>--help</code>, <code>-h</code><br>
    Print this help message</p>
</li>
<li>
<p><code>--version</code>, <code>-v</code><br>
    Print version</p>
</li>
</ul>
<h3>Examples</h3>
<p><code>canonical_configuration -n 10 -t 300</code> </p>
<p><code>canonical_configuration -n 300 -t 0 --quantum</code> </p>
<p><code>canonical_configuration -n 20 -t 10 --quantum --debye_temperature 400</code> </p>
<h3>Longer summary</h3>
<p>This code takes a second order <a href="extract_forceconstants.html">forceconstant</a> and generates a supercell with the atoms displaced corresponding to a harmonic canonical ensemble. These configurations can be used directly, to generate force-displacement statistics to determine force constants and other thermal properties, or as the starting point for molecular dynamics.</p>
<p></p><div class="alert alert-success" role="alert"><h4>Todo</h4><p>Update this to explain how to do statistical sampling in clever ways, but probably not before I actually publish it.</p></div>
<h3>Background</h3>
<p>Born-Oppenheimer molecular dynamics can be expensive for many reasons. Firstly, it requires supercells with more than 100 atoms. Secondly, computation of the electronic ground state at every time step is time consuming. Thirdly, the cell must be fully equilibrated. The precision of the calculations is statistically linked to the number of configurations used: any property $A$ for which we want to calculate the ensemble average $\langle A \rangle$ must be converged with respect to the number of uncorrelated time steps.</p>
<p>To minimise the equilibration time, the simulation cell can be initialised to a thermally excited state by selecting initial atomic velocities and displacement amplitudes according to the Maxwell-Boltzmann<sup id="fnref-West2006"><a class="footnote-ref" href="#fn-West2006">1</a></sup> or Bose - Einstein distributions.</p>
<p>Starting with the equations of motion for the supercell (given harmonic <a href="../program/extract_forceconstants.html">force constants</a>)</p>
<p>$$
\begin{equation}
\begin{pmatrix}
m_1 \ddot{\mathbf{u}}_1 \\
m_2 \ddot{\mathbf{u}}_2 \\
\vdots \\
m_{N_a} \ddot{\mathbf{u}}_{N_a}
\end{pmatrix}=
\begin{pmatrix}
\mathbf{\Phi}_{11} &amp; \mathbf{\Phi}_{12} &amp; \cdots &amp; \mathbf{\Phi}_{1N_a} \\
\mathbf{\Phi}_{21} &amp; \mathbf{\Phi}_{22} &amp; \cdots &amp; \mathbf{\Phi}_{2N_a} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\mathbf{\Phi}_{N_a1} &amp; \mathbf{\Phi}_{N_a2} &amp; \cdots &amp; \mathbf{\Phi}_{N_aN_a} 
\end{pmatrix}
\begin{pmatrix}
\mathbf{u}_1\\
\mathbf{u}_2 \\
\vdots \\
\mathbf{u}_{N_a} \\
\end{pmatrix}
\end{equation}
$$ </p>
<p>we diagonalise these and get obtaining $3N_a$ eigenvalues $\omega^2_s$ and eigenvectors $\epsilon_s$. In the given cell, we can use this normal mode transformation to express the instantaneous positions and velocities,</p>
<p>$$
\begin{align}
u_i = &amp; \sum_{s=1}^{3N_a} \epsilon_{is} A_{is} \sin( \omega_s t+\delta_s ) \\
\dot{u}_i = &amp; \sum_{s=1}^{3N_a} \epsilon_{is} A_{is} \omega_s \cos( \omega_s t+\delta_s) 
\end{align}
$$</p>
<p>where the normal mode amplitudes $A_s$ and the phase $\delta_s$ will be determined by the following boundary conditions: we require a set of positions and velocities that correspond to a canonical ensemble. We choose $A_s$ so that they are normally distributed around their mean value and that each mode $s$ should contribute, on average, $k_B T/2$ to the internal energy. Then</p>
<p>$$
\begin{equation}
\langle A_{is} \rangle = 
\sqrt{\frac{\hbar (2n_s+1) }{2 m_i \omega_s}} 
\approx
\frac{1}{\omega_s}\sqrt{\frac{k_BT}{m_i}},
\end{equation}
$$</p>
<p>where the approximate result is in the classical limit, $\hbar \omega \ll k_BT $. The appropriate distribution of atomic positions and velocities is given by,</p>
<p>$$
\begin{align}
u_i &amp; = \sum_{s=1}^{3N_a} 
\epsilon_{is} \langle A_{is} \rangle \sqrt{-2\ln \xi_1}\sin 2\pi\xi_2 \\
\dot{u}_i &amp; = \sum_{s=1}^{3N_a}
\omega_s \epsilon_{is} \langle A_{is} \rangle \sqrt{-2\ln \xi_1}\cos 2\pi\xi_2
\end{align}
$$</p>
<p>Here, $0 \lt \xi_n \lt 1$, represents a uniform distribution of random numbers, which are transformed to a normal distribution using the standard Box-Muller transform. </p>
<p>Choosing the mean amplitudes in the classical limit gives us a snapshot in time from a canonical Maxwell-Boltzmann ensemble (within the harmonic approximation), which results in a starting point that reduces the time until equilibration by orders of magnitude. Choosing a Bose-Einstein distribution of mean amplitudes and velocities instead allows us to sample phase space while including quantum thermal disorder at low temperatures.</p>
<p>For applications where one does not need consecutive timesteps, the starting configurations generated by this can be used  by run several simultaneous instances of Born-Oppenheimer molecular dynamics with different random starting configurations, rather than running a single long instance. This strategy allows for parallelization of Born-Oppenheimer molecular dynamics with near perfect linear scaling, since the overhead of equilibration time is almost completely eliminated.</p>
<p><center>
<img src="../media/phase_space_spanning.png" width="500" />
</center></p>
<p>This is illustrated in the plot above. This is the singular value decomposition of molecular dynamics trajectories. A single colored field corresponds to data from a single random initial starting configuration. The dimensions spanned per unit time is greatly increased by stitching together calculations from different initial configurations. That is, 10 MD runs of 1000 time steps explores phase space better than a single MD run of 10x1000 time steps.</p>
<h4>Matching with a Debye temperature</h4>
<p>Up until this point we have assumed you have <a href="extract_forceconstants.html">forceconstants</a> to generate the normal mode displacements. If you don't, it's possible to guess them. The following procedure is used: assume a pair potential $U(r)$ which obeys</p>
<p>$$
\begin{equation}
\frac{ \partial U(r)}{\partial r_{ij} }=0
\end{equation}
$$</p>
<p>and</p>
<p>$$
\begin{equation}
\frac{ \partial^2 U(r)}{\partial r_{ij}^2 }=\frac{\alpha}{r_{ij}^4}
\end{equation}
$$</p>
<p>Here $r_{ij}$ is a pair distance in the supercell. Forceconstants can be calculated analytically from a pair potential, in this case they are given by</p>
<p>$$
\begin{equation}
\mathbf{\Phi}(r)=
-\frac{\alpha}{r^6}
\begin{pmatrix}
r_x^2 &amp; r_x r_y &amp; r_x r_z \\
r_x r_y &amp; r_y^2 &amp; r_y r_z \\
r_x r_z &amp; r_y r_z &amp; r_z^2  
\end{pmatrix}
\end{equation}
$$</p>
<p>By definition, this will always produce stable phonons with the correct symmetry. The parameter $\alpha$ is determined by numerically matching the zero-point motion of the phonons to a Debye temperature:</p>
<p>$$
\begin{equation}
\frac{1}{N} \sum_i \frac{\hbar \omega_i(\alpha)}{2} = \frac{9 k_B T_D}{8}
\end{equation}
$$</p>
<p>Using actual forceconstants is of course better, but this procedure generates surprisingly good configurations.</p>
<h3>Input files</h3>
<ul>
<li><a href="../page/files.html#infile.ucposcar">infile.ucposcar</a></li>
<li><a href="../page/files.html#infile.ucposcar">infile.ssposcar</a> (use <a href="generate_structure.html">generate structure</a> to create one)</li>
<li><a href="../page/files.html#infile.forceconstant">infile.forceconstant</a> (or use <code>--debye_temperature</code> as described above)</li>
</ul>
<h3>Output files</h3>
<p>The desired number of configurations are printed in VASP POSCAR <a href="../page/files.html#infile.ucposcar">format</a> </p>
<ul>
<li>contcar_conf0001</li>
<li>contcar_conf0002</li>
<li>contcar_conf0003</li>
<li>...</li>
</ul>
<p>or alternatively in Abinit format:</p>
<ul>
<li>abinput_conf0001</li>
<li>abinput_conf0002</li>
<li>abinput_conf0003</li>
<li>...</li>
</ul>
<p>In case you used a Debye temperature to generate the configurations, <code>outfile.fakeforceconstant</code> will be written. Use <a href="phonon_dispersion_relations.html">phonon dispersion relations</a> to plot it and check that the frequencies are reasonable.</p>
<div class="footnote">
<hr>
<ol>
<li id="fn-West2006">
<p><a href="http://doi.org/10.1103/PhysRevLett.96.115504">West, D., &amp; Estreicher, S. (2006). First-Principles Calculations of Vibrational Lifetimes and Decay Channels: Hydrogen-Related Modes in Si. Physical Review Letters, 96(11), 115504.</a>&#160;<a class="footnote-backref" href="#fnref-West2006" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>

<!--
    <br>
    
  
    <ul class="list-inline">
      <li><h4>Uses:</h4></li>
      
      <li>constants</li>
      
      <li>helpers</li>
      
      <li>options</li>
      
      <li>type_qpointmesh</li>
      
      <li>type_phonon_dispersions</li>
      
      <li>type_crystalstructure</li>
      
      <li>type_forceconstant_secondorder</li>
      
      <li>type_qpointmesh</li>
      
      <li>type_lotosplitting</li>
      
    </ul>
    
    

    
    
    
    <br>

    
    
    
    
    
    
    

    
    
    


    
    
    
-->    
    </div>
  </div>

    <br>
    <br>
</div> <!-- /container -->

</div><!-- end of wrapper -->

<div class="footer">
<div class="container"> 
        <br>
        <div class="row">
            <div class="col-md-4">&copy; 2016 </div>
            <div class="col-md-4"><span class="text-center"> TDEP was developed by Olle Hellman</span></div>
            <div class="col-md-4"><span class="pull-right">Documentation generated by <a href="https://github.com/cmacmackin/ford">FORD</a></span></div>
        </div>
        <br>
        <br>
</div>
</div>

    <!-- Bootstrap core JavaScript -->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>
    <!-- MathJax JavaScript -->
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],
            TeX: { 
                extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], 
                equationNumbers: { autoNumber: 'AMS' } 
            },
            jax: ['input/TeX','input/MathML','output/HTML-CSS'],
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                processEscapes: true
            },
            'HTML-CSS': { 
                styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: '#000000 ! important'} }
            }
        });
    </script>
    <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>